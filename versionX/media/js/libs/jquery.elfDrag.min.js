$.fn.extend({elfDrag:function(d){var c=$.extend({"$target":false},d);var a={fadeTime:typeof(window.myPage.fadeTime)!=="undefined"?window.myPage.fadeTime:0,isIn:function(e,i,f){if(!f||!f.offset()){return false}var h=[f.offset().left,f.offset().left+f.outerWidth()];var g=[f.offset().top,f.offset().top+f.outerHeight()];return e>=h[0]&&e<=h[1]&&i>=g[0]&&i<=g[1]}};var b=function(h,m){var l=$(m);if(c.$target===false){c.$target=l.parent()}var j=function(){l.attr("data-style",l.attr("style")||"")};var g=function(e){var i=e;var n=function(){var r,v,w,t,A,p,u,s;var z=l.closest("body");r=l.offset().left;v=l.offset().top;w=i.pageX;t=i.pageY;A=z.width();p=z.height();var o={X:r+(l.outerWidth()/2),Y:v+(l.outerHeight()/2)};var D=["left","top"];var y={X:0,Y:0};var x={X:10,Y:Math.min(10,l.outerWidth()/l.outerHeight()*10)};y.X=o.Y-t>0?Math.min(x.X,o.Y-t):Math.max(0-x.X,o.Y-t);y.Y=o.X-w>0?Math.min(x.Y,o.X-w):Math.max(0-x.Y,o.X-w);D[0]=w>o.X?"right":"left";D[1]=t>o.Y?"bottom":"top";var C=function(E){var F=false;c.$target.each(function(G,H){if(a.isIn(E.pageX,E.pageY,$(H))){F=$(H);return false}});return F};var q=function(F){F.preventDefault();u=F.pageX-w+r;s=F.pageY-t+v;if(F.pageX<0||F.pageY<0||F.pageX>A||F.pageY>p){return false}l.addClass("moving").css({position:"absolute",left:l.width()===A?0:u,top:s});var E=function(G){var H=function(){if(I===false){return false}var L=$("#dragPosition");if(L.length===0){$("body").append('<div class="dragPosition" id="dragPosition" style="display:none;"></div>');L=$("#dragPosition")}L.css({width:l.outerWidth(),height:l.outerHeight(),background:"rgba(255,0,0,0.2)"});var J=I.children().not(l).not("#dragPosition");if(J.length>=1){var K=false;J.each(function(M,N){if(a.isIn(G.pageX,G.pageY,$(N))){K=$(N);return false}});if(K!==false){L.insertAfter(K);L.show()}else{L.appendTo(I);L.show()}}else{L.appendTo(I);L.show()}};var I=C(G);if(I===false){$("#dragPosition").remove()}else{if(!I.find(l).length>0){H()}else{if(I[0].tagName!=="BODY"){H()}else{$("#dragPosition").hide()}}}};if(typeof(window.waitMoveThisTimeout)!=="undefined"){clearTimeout(window.waitMoveThisTimeout)}window.waitMoveThisTimeout=setTimeout(E,300,F)};var B=function(G){z[0].removeEventListener("mousemove",q);z[0].removeEventListener("mouseup",B);l.css({cursor:"auto"}).removeClass("dragActive");z.css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","-khtml-user-select":"","user-select":""});if(typeof(window.waitMoveThisTimeout)!=="undefined"){clearTimeout(window.waitMoveThisTimeout)}$("#dragPosition").remove();var E=function(){if(F===false){return false}if(!l.hasClass("moving")){l.removeClass("moving");return false}else{l.removeClass("moving")}var H=F.children().not(l).not("#dragPosition");if(H.length>=1){var I=false;H.each(function(J,K){if(a.isIn(G.pageX,G.pageY,$(K))){I=$(K);return false}});if(I!==false){l.insertAfter(I);l.attr("style",l.attr("data-style"))}else{l.appendTo(F);l.attr("style",l.attr("data-style"))}}else{l.appendTo(F);l.attr("style",l.attr("data-style"))}};var F=C(G);if(F===false){l.attr("style",l.attr("data-style"))}else{if(!F.find(l).length>0){E()}else{if(F.children().length>1&&F[0].tagName!=="BODY"){E()}l.css({"z-index":"initial",transform:"initial","transform-origin":"initial","-webkit-transform":"initial","-webkit-transform-origin":"initial"})}}};l.removeClass("dragHover").addClass("dragActive").css({"-webkit-transform":"rotateX("+y.X+"deg) rotateY("+y.Y+"deg)","-webkit-transform-origin":D.join(" "),"z-index":999999});l.css({cursor:"move"});z.css({"-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","-khtml-user-select":"none","user-select":"none"});z[0].removeEventListener("mousemove",q);z[0].removeEventListener("mouseup",B);z[0].addEventListener("mousemove",q);z[0].addEventListener("mouseup",B)};if(l.hasClass("readOnly")||l.hasClass("disable")){return false}n()};var k=function(){if(l.hasClass("readOnly")||l.hasClass("disable")){return false}$(this).addClass("dragHover")};var f=function(){if(l.hasClass("readOnly")||l.hasClass("disable")){return false}$(this).removeClass("dragHover")};j();l.off("mousedown").on("mousedown",g);l.off("mouseenter").on("mouseenter",k);l.off("mouseleave").on("mouseleave",f)};$(this).each(b);return this.each(function(){})}});