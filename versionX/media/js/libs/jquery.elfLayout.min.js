(function(a){a.fn.extend({elfLayout:function(H){a(this).elfLayoutExit();var G=a.extend({scale:"no",referenceY:null,referenceX:null,callback:false},H);var n=a(this);var k=a(this);var h=a(this);var O=a(G.referenceY);var P=a(G.referenceX);var M=G.scale;var e,U,K,j,X;var d,f;var R,T;var I,u;var t,r;var y,p;var J,v;var l,g,Q;var m,i,S;var A,C;var q,s;var N,L;var b,c;var V,W;var w=0,x=0;var E=new Date().getTime();var B="dataElfLayoutId"+E;var z="data_style_record_"+E;window[B]={};var D=function(){e=parseInt(n.css("margin"));U=parseInt(n.css("margin-top"));K=parseInt(n.css("margin-bottom"));j=parseInt(n.css("margin-left"));X=parseInt(n.css("margin-right"));n.attr("data_elflayout_id",B);P.attr("data_elflayout_id",B);O.attr("data_elflayout_id",B);if(G.referenceY!==null){if(O.outerHeight()<k.outerHeight()){O=k;k=a(G.referenceY)}if(!O[0].hasAttribute(z)){O.attr(z,(O.attr("style")||""))}if(!k[0].hasAttribute(z)){k.attr(z,(k.attr("style")||""))}J=parseInt(a(window).innerHeight());l=parseInt(O.offset().top);g=parseInt(O.offset().top)+parseInt(O.height());I=parseInt(k.outerHeight())+U+K;y=parseInt(O.outerHeight());t=k.offset().left;if(y<=J&&I<=J){Q=0}if(I>J){k.innerHeight(J-U-K);A=I-J;Q=0}else{if(I<J){k.innerHeight(I);A=0;Q=l+J-k.offset().top-I}}g=g+Q;q=g-l-J}else{if(G.referenceX!==null){if(p<=v&&u<=v){return false}if(P.outerWidth()<h.outerWidth()){P=h;h=a(G.referenceX)}if(!h[0].hasAttribute(z)){h.attr("style",h.attr(z))}if(!P[0].hasAttribute(z)){P.attr("style",P.attr(z))}h.css({overflow:"hidden"});v=parseInt(a(window).innerWidth());m=parseInt(P.offset().left);i=parseInt(P.offset().left)+parseInt(P.width());u=parseInt(h.outerWidth())+j+X;p=parseInt(P.outerWidth());r=k.offset().top;if(u>v){h.innerWidth(v-j-X);C=u-v;S=0}else{if(u<v){h.innerWidth(u);C=0;S=m+v-h.offset().left-u}}i=i+S;s=i-m-v}}if(G.callback){G.callback.call(this)}window.addEventListener("scroll",window[B].scrollDirection);window.addEventListener("resize",window[B].waitResizeFinish);var ab=a(G.referenceX||G.referenceY);var aa=function(){return[ab.width(),ab.height()].join("&")};var Y=aa();var Z=function(){if((aa()===Y)||(ab[0].style.position==="fixed")||(ab[0].style.position==="absolute")){return false}var ac=[a(window).scrollLeft(),a(window).scrollTop()];G.callback=function(){window.scrollTo(ac[0],ac[1])};n.elfLayout(G)};if(typeof(window[B].listenSize)!=="undefined"){clearInterval(window[B].listenSize)}window[B].listenSize=setInterval(Z,500)};window[B].scrollDirection=function(){V=a(window).scrollTop();W=a(window).scrollLeft();if(V!==w&&G.referenceY!==null&&q>0){F();w=V}if(W!==x&&G.referenceX!==null&&s>0){o();x=W}};window[B].waitResizeFinish=function(){if(typeof(window[B].resizeWindow)!=="undefined"){clearTimeout(window[B].resizeWindow)}window[B].resizeWindow=setTimeout(function(){var Y=[a(window).scrollLeft(),a(window).scrollTop()];G.callback=function(){window.scrollTo(Y[0],Y[1])};n.elfLayout(G)},500)};var F=function(){b=a(document).scrollTop();if(b>l&&(b+J)<g){k.css({position:"fixed",width:k.width(),height:J-U-K,overflow:"hidden",top:"0",left:t,"margin-top":U,"margin-left":j,"margin-right":X});if(M==="yes"&&I>J){d=(b-l)/q;k.scrollTop(d*A);a("#val").html(Math.round(d*100)+"%")}else{if(M==="no"&&I>J){R=b-N;k.scrollTop(k.scrollTop()+R);N=b}}}else{if(b>l&&(b+J)>=g){k.css({position:"absolute",top:"0",width:k.width(),"margin-top":(g-J+U),overflow:"hidden"}).scrollTop(A)}else{if(b<l){k.attr("style",k.attr(z));O.attr("style",O.attr(z))}}}};var o=function(){c=a(document).scrollLeft();if(c>m&&(c+v)<i){if(a("#appendTemp").length<=0){h.after("<div id='appendTemp' style='width:"+u+"px; height:"+h.height()+"px; visibility:hidden'></div>")}h.css({position:"fixed",width:v-j-X,overflow:"hidden",left:"0",top:r,"margin-top":U,"margin-left":j,"margin-right":X});if(M==="yes"&&u>v){f=((c-m)/s).toFixed(2);h.scrollLeft(f*C);a("#val").html(parseInt(f*100).toString()+"%")}else{if(M==="no"&&u>v){T=c-L;h.scrollLeft(h.scrollLeft()+T);L=c}}}else{if(c>m&&(c+v)>=i){h.css({position:"absolute",left:"0px","margin-left":(i-v+j),overflow:"hidden"}).scrollLeft(C)}else{if(c<=m){a("#appendTemp").remove();h.attr("style",h.attr(z));P.attr("style",P.attr(z))}}}};D();return this},elfLayoutExit:function(){var b=a(this).attr("data_elflayout_id");if(!b){return false}var c="data_style_record_"+b.replace("dataElfLayoutId","");a("[data_elflayout_id="+b+"]").each(function(d,f){a(f).attr("style",a(f).attr(c));a(f).removeAttr(c);a(f).removeAttr("data_elflayout_id")});window.removeEventListener("scroll",window[b].scrollDirection);window.removeEventListener("resize",window[b].waitResizeFinish);if(typeof(window[b].listenSize)!=="undefined"){clearInterval(window[b].listenSize)}return this}})})(jQuery);